<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>CAPEPS 2026 - Master v2.9 FINAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .modal.active { display: flex; align-items: center; justify-content: center; }
        .nav-active { border-bottom: 4px solid #ef4444 !important; color: #ef4444 !important; }
        .mini-progress { height: 3px; background: rgba(255,255,255,0.1); border-radius: 2px; margin-top: 2px; width: 60px; overflow: hidden; }
        .mini-progress-bar { height: 100%; background: #fbbf24; transition: width 0.3s; }
        .correct-flash { background-color: #22c55e !important; color: white !important; border-color: #166534 !important; }
        .bar-chart { display: flex; align-items: flex-end; gap: 8px; height: 120px; padding: 15px; background: #f8fafc; border-radius: 12px; border: 1px solid #e2e8f0; }
        .bar-group { display: flex; align-items: flex-end; gap: 2px; height: 100%; }
        .bar-success { background: #22c55e; width: 12px; border-radius: 2px 2px 0 0; transition: height 0.5s; }
        .bar-error { background: #ef4444; width: 12px; border-radius: 2px 2px 0 0; transition: height 0.5s; }
        .nav-btn { cursor: pointer; position: relative; z-index: 60; }
    </style>
</head>
<body class="bg-slate-100 font-sans text-slate-900">

    <header class="bg-red-700 text-white p-6 shadow-xl relative z-10">
        <div class="max-w-6xl mx-auto flex justify-between items-center mb-4">
            <h1 class="text-3xl font-black italic uppercase">Sprint F√©vrier <span class="text-yellow-400 text-sm">V2.9</span></h1>
            <div class="text-right">
                <p class="text-[9px] text-yellow-300 font-bold uppercase mb-1 animate-pulse italic">‚ö†Ô∏è Pensez √† sauvegarder r√©guli√®rement</p>
                <div class="flex gap-2 mb-1 justify-end">
                    <button onclick="exportData()" class="bg-green-600 px-3 py-1 rounded text-xs font-bold hover:bg-green-500">EXPORT</button>
                    <button onclick="document.getElementById('importFile').click()" class="bg-blue-600 px-3 py-1 rounded text-xs font-bold hover:bg-blue-500">IMPORT</button>
                    <input type="file" id="importFile" class="hidden" onchange="importData(event)">
                </div>
                <p id="lastSync" class="text-[10px] opacity-70 font-mono">Session Active</p>
            </div>
        </div>
        <div class="max-w-6xl mx-auto bg-red-900/50 rounded-full h-4 overflow-hidden border border-red-400/30">
            <div id="mainProgressBar" class="bg-yellow-400 h-full transition-all duration-500" style="width: 0%"></div>
        </div>
    </header>

    <nav class="bg-white shadow-md sticky top-0 z-[100]">
        <div class="max-w-6xl mx-auto flex">
            <button onclick="showTab('planning')" id="btn-planning" class="nav-btn flex-1 py-4 font-bold nav-active uppercase text-xs">üìÖ Planning Mensuel</button>
            <button onclick="showTab('biblio')" id="btn-biblio" class="nav-btn flex-1 py-4 font-bold text-gray-500 border-b-4 border-transparent uppercase text-xs">üìö Biblioth√®que</button>
            <button onclick="showTab('quiz')" id="btn-quiz" class="nav-btn flex-1 py-4 font-bold text-gray-500 border-b-4 border-transparent uppercase text-xs">üß† Quiz</button>
            <button onclick="showTab('recap')" id="btn-recap" class="nav-btn flex-1 py-4 font-bold text-gray-500 border-b-4 border-transparent uppercase text-xs">üìã R√©cap</button>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-6 relative z-10">
        <section id="planning" class="tab-content active">
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="bg-slate-800 text-white p-6 rounded-2xl shadow-xl border-t-4 border-red-500">
                    <p class="text-red-400 font-bold text-[10px] uppercase mb-1">Semaine 1 : Hygi√©nisme (1880-1936)</p>
                    <h3 class="font-black text-lg mb-4 leading-tight">L'institutionnalisation de la Gymnastique</h3>
                    <div class="space-y-3 text-gray-300 text-[11px]">
                        <p><strong class="text-white">√âtude :</strong> Lois Ferry, Loi George (1880).</p>
                        <p><strong class="text-white">Courants :</strong> Analytique (Demeny) vs Naturelle (H√©bert).</p>
                        <p><strong class="text-white">Enjeu :</strong> Former des soldats et des citoyens sains.</p>
                        <div class="pt-2 border-t border-slate-700 text-yellow-400 font-bold"><i class="fas fa-book-open mr-1"></i> PDF : 1. Citoyennet√© et Corps</div>
                    </div>
                </div>
                <div class="bg-slate-800 text-white p-6 rounded-2xl shadow-xl border-t-4 border-red-500">
                    <p class="text-red-400 font-bold text-[10px] uppercase mb-1">Semaine 2 : Front Populaire & Vichy (1936-1959)</p>
                    <h3 class="font-black text-lg mb-4 leading-tight">L'EP entre loisirs et id√©ologie d'√âtat</h3>
                    <div class="space-y-3 text-gray-300 text-[11px]">
                        <p><strong class="text-white">√âtude :</strong> L√©o Lagrange (1936), Borotra/Vichy (1941).</p>
                        <p><strong class="text-white">Textes :</strong> IO 1945, Plan Langevin-Wallon.</p>
                        <div class="pt-2 border-t border-slate-700 text-yellow-400 font-bold"><i class="fas fa-book-open mr-1"></i> PDF : 2. Savoirs & Sciences</div>
                    </div>
                </div>
                <div class="bg-slate-800 text-white p-6 rounded-2xl shadow-xl border-t-4 border-red-500">
                    <p class="text-red-400 font-bold text-[10px] uppercase mb-1">Semaine 3 : Sportivisation (1959-1981)</p>
                    <h3 class="font-black text-lg mb-4 leading-tight">L'entr√©e triomphale du Sport √† l'√âcole</h3>
                    <div class="space-y-3 text-gray-300 text-[11px]">
                        <p><strong class="text-white">√âtude :</strong> Herzog (1962), IO 1967 (les 3 finalit√©s).</p>
                        <p><strong class="text-white">Crise :</strong> Plan Soisson (1978).</p>
                        <div class="pt-2 border-t border-slate-700 text-yellow-400 font-bold"><i class="fas fa-book-open mr-1"></i> PDF : 4. Combat / 5. APPN / 7. Transfo. √âcole</div>
                    </div>
                </div>
                <div class="bg-slate-800 text-white p-6 rounded-2xl shadow-xl border-t-4 border-red-500">
                    <p class="text-red-400 font-bold text-[10px] uppercase mb-1">Semaine 4 : √âducation Nationale (1981-2000)</p>
                    <h3 class="font-black text-lg mb-4 leading-tight">L'EPS devient une discipline √† part enti√®re</h3>
                    <div class="space-y-3 text-gray-300 text-[11px]">
                        <p><strong class="text-white">√âtude :</strong> D√©cret 1981 (Rattachement MEN), Loi Jospin (1989).</p>
                        <div class="pt-2 border-t border-slate-700 text-yellow-400 font-bold"><i class="fas fa-book-open mr-1"></i> PDF : 3. Formation / 6. Mixit√©</div>
                    </div>
                </div>
                <div class="bg-slate-800 text-white p-6 rounded-2xl shadow-xl border-t-4 border-red-500">
                    <p class="text-red-400 font-bold text-[10px] uppercase mb-1">Semaine 5 : Socle Commun (2000-Auj)</p>
                    <h3 class="font-black text-lg mb-4 leading-tight">L'√©l√®ve acteur de sa sant√© et de ses progr√®s</h3>
                    <div class="space-y-3 text-gray-300 text-[11px]">
                        <p><strong class="text-white">√âtude :</strong> Socle Commun (2006/2015), Programmes 2015.</p>
                        <div class="pt-2 border-t border-slate-700 text-yellow-400 font-bold"><i class="fas fa-book-open mr-1"></i> PDF : 8. Technique / 9. Effort / 10. Corps</div>
                    </div>
                </div>
                <div class="bg-slate-800 text-white p-6 rounded-2xl shadow-xl border-t-4 border-red-500">
                    <p class="text-red-400 font-bold text-[10px] uppercase mb-1">Semaine 6 : R√©visions & √âcrit 1</p>
                    <h3 class="font-black text-lg mb-4 leading-tight">M√©thodologie et Citations de r√©f√©rence</h3>
                    <div class="space-y-3 text-gray-300 text-[11px]">
                        <p><strong class="text-white">Entra√Ænement :</strong> Dissertation ruptures/continuit√©s.</p>
                        <div class="pt-2 border-t border-slate-700 text-yellow-400 font-bold"><i class="fas fa-book-open mr-1"></i> PDF : Synth√®se Globale</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="biblio" class="tab-content">
            <div id="planGlobal" class="bg-slate-800 text-white p-6 rounded-3xl mb-8 shadow-xl border-b-4 border-yellow-500"></div>
            <div class="mb-6 flex gap-2">
                <input type="text" id="searchBiblio" onkeyup="searchContent()" placeholder="Recherche..." class="w-80 p-4 rounded-xl border shadow-inner">
                <button onclick="clearSearch()" class="bg-slate-400 text-white px-6 rounded-xl font-bold uppercase text-xs cursor-pointer">Annuler</button>
            </div>
            <div id="biblioList" class="grid md:grid-cols-3 gap-4"></div>
        </section>

        <section id="quiz" class="tab-content">
            <div class="bg-white p-10 rounded-3xl shadow-xl border border-slate-200 max-w-4xl mx-auto">
                <div class="flex justify-between items-center mb-8 border-b pb-4">
                    <h2 class="font-black text-slate-800 uppercase tracking-tighter text-xl">üß† Quiz de Pr√©paration</h2>
                    <div class="text-right">
                        <p class="text-[10px] font-bold text-red-600 uppercase">Score : <span id="quizScore">0</span></p>
                        <p class="text-[10px] text-slate-400 uppercase">Progression : <span id="quizCount">1</span>/30</p>
                    </div>
                </div>
                <div id="quizArea" class="min-h-[300px]">
                    <p id="questionText" class="text-xl font-black mb-8 text-slate-700 leading-tight"></p>
                    <div id="optionsArea" class="grid gap-4"></div>
                    <div id="feedbackArea" class="hidden mt-8 p-4 rounded-xl border-2 transition-all duration-300"></div>
                </div>
                <div class="mt-10 flex justify-between items-center">
                    <button onclick="resetQuiz()" class="text-[10px] font-bold text-slate-400 hover:text-red-600 uppercase cursor-pointer">R√©initialiser</button>
                    <button id="nextBtn" onclick="nextQuestion()" class="hidden bg-slate-800 text-white px-8 py-3 rounded-xl font-bold uppercase shadow-lg hover:bg-slate-700 transition cursor-pointer">Question suivante</button>
                </div>
            </div>
        </section>

        <section id="recap" class="tab-content">
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-3xl shadow">
                    <h2 class="font-black uppercase text-slate-700 text-sm mb-4">Analyse des scores</h2>
                    <div id="scoreChart" class="bar-chart mb-6 items-end"></div>
                    <div id="historyTable" class="space-y-2"></div>
                </div>
                <div class="bg-white p-6 rounded-3xl shadow border-l-8 border-red-500">
                    <h2 class="font-black uppercase text-red-600 text-sm mb-4">Focus Points Faibles</h2>
                    <div id="weaknessArea" class="space-y-4"></div>
                </div>
            </div>
        </section>
    </main>

    <div id="contentModal" class="modal" onclick="closeModal()">
        <div class="bg-white w-full max-w-xl p-8 rounded-3xl relative mx-4" onclick="event.stopPropagation()">
            <div id="modalBody"></div>
            <button onclick="closeModal()" class="w-full bg-slate-800 text-white py-4 rounded-xl mt-6 font-bold uppercase cursor-pointer">Fermer</button>
        </div>
    </div>

    <script>
        const PDF_DATA = {
            cit: { type: "E1", title: "1. Citoyennet√© et Corps", file: "New [Item 1 - Transmettre et adapter] La formation du citoyen et l'√©ducation du corps.pdf", tags: "citoyennete saint martin civisme morale valeurs 2004 republique responsabilite" },
            sav: { type: "E1", title: "2. Savoirs & Sciences", file: "New [Item 1 - Transmettre et adapter] Les savoirs enseign√©s et √† enseigner - √âvaluation - Sciences en EP.pdf", tags: "savoirs evaluation sciences parlebas 1967 famose cognitivistes didactique" },
            form: { type: "E1", title: "3. Formation Enseignants", file: "New [Item 1 - Transmettre et adapter] Formation des enseignants et organisation du travail de l'√©l√®ve.pdf", tags: "formation enseignants mafpen 1982 espe enseignement pedagogie staps" },
            comb: { type: "E1", title: "4. Activit√©s de Combat", file: "New [Item 2 - Le geste et l'effort] √âvolution des activit√©s physiques de combat.pdf", tags: "combat lutte judo opposition parlebas 1981 groenen ottogalli violence maitrise" },
            appn: { type: "E1", title: "5. √âvolution APPN", file: "New [Item 2 - Le geste et l'effort] L'√©volution des activit√©s physiques de pleine nature.pdf", tags: "appn escalade risque securite nature saint-martin 2014 environnement famose" },
            mix: { type: "E1", title: "6. Mixit√© & Arts", file: "New [Item 2 - Le geste et l'effort] Place des filles √† l'√©cole - Mixit√© - √âvolutions des activit√©s physiques artistiques.pdf", tags: "mixite danse filles femmes terret 2006 egalite stereotypes genre" },
            trans: { type: "E1", title: "7. Transformations √âcole", file: "New [Item 3 - D√©bats et controverses] Transformation de l'√©cole, de l'EPS et du sport scolaire.pdf", tags: "soisson 1978 unss sport scolaire ecole republique fouquet rouyer mefiance 1880 opposition 1936" },
            tech: { type: "E2", title: "8. Axe 1 : Technique", file: "Axe 1 [E2] Axe 1 - Technique, technologie et apprentissage moteur.pdf", tags: "technique baudrit cooperation slavin technologie moteur" },
            eff: { type: "E2", title: "9. Axe 2 : Effort", file: "Axe 2 [E2] Axe 2 - Effort, bien-etre et sensation.pdf", tags: "effort garcin bien-etre sensations fatigue" },
            ado: { type: "E2", title: "10. Axe 3 : Corps & Ado", file: "Axe 3 [E2] Axe 3 - Corps, adolescence et enjeux du monde contemporain.pdf", tags: "corps adolescence performance saury tessier" }
        };

        const QUIZ_DB = [
            { id: 1, q: "En quelle ann√©e l'EPS est rattach√©e au MEN ?", a: ["1936", "1967", "1981", "1945"], c: 2, r: "D√©cret 1981." },
            { id: 2, q: "Quel texte de 1978 provoque la crise du sport scolaire ?", a: ["Plan Soisson", "Loi Avice", "Herzog"], c: 0, r: "Plan Soisson (s√©paration EPS/AS)." },
            { id: 50, q: "D√©finition Didactique (Perrenoud, 1988) :", a: ["R√©flexion sur l'appropriation de savoirs sp√©cifiques", "Art de la transmission", "Gestion de classe"], c: 0, r: "Reflexion sur les savoirs sp√©cifiques." },
            { id: 60, q: "D√©finition P√©dagogie (Debesse, 1988) :", a: ["Reflexion didactique", "Art de la relation enfant/savoir", "Science du sport"], c: 1, r: "Construire une manche entre l'enfant et le savoir." },
            { id: 61, q: "Culture (Moor, 2000) :", a: ["Activit√©s sportives", "Ensemble des normes, r√®gles, id√©es et valeurs", "Loisirs"], c: 1, r: "Normes, r√®gles, valeurs transmises de g√©n√©ration en g√©n√©ration." },
            { id: 62, q: "Valeurs (Sciences Humaines, 1992) :", a: ["R√®gles du jeu", "Principes et id√©aux r√©gissant comportements et jugements", "Techniques"], c: 1, r: "Principes et id√©aux d'un individu ou groupe." },
            { id: 63, q: "EPS (H√©brard, 1986) :", a: ["Sport √† l'√©cole", "Discipline permettant gestion de la vie et acc√®s au sport", "Gymnastique"], c: 1, r: "Acquisition de connaissances pour la gestion de la vie physique." },
            { id: 64, q: "Prax√©ologie motrice :", a: ["√âtude du sport", "Science de l'action motrice (Parlebas)", "Technique corporelle"], c: 1, r: "Pierre Parlebas : √©tude des actions motrices." },
            { id: 14, q: "Date mixit√© obligatoire en EPS ?", a: ["1975", "1981", "1967"], c: 0, r: "Loi Haby (1975)." },
            { id: 55, q: "Qu'est-ce que l'√¢ge p√©dagogique (Loisel, 1935) ?", a: ["Fin du m√©dical au profit du p√©dagogique", "D√©but de la maternelle", "√Çge de la comp√©tition"], c: 0, r: "Transition historique majeure." }
        ];

        let timers = { cit: 0, sav: 0, form: 0, comb: 0, appn: 0, mix: 0, trans: 0, tech: 0, eff: 0, ado: 0 };
        let quizSession = { count: 1, score: 0, corrects: 0, errors: 0, currentSessionIds: [] };
        let quizHistory = [];
        let globalErrors = {}; 
        let activeTimer = null;
        let startTime = null;

        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => {
                b.classList.remove('nav-active', 'text-red-600');
                b.classList.add('text-gray-500', 'border-transparent');
            });
            const btn = document.getElementById('btn-' + id);
            if(btn) btn.classList.add('nav-active', 'text-red-600');
            if(id === 'biblio') { renderBiblio(); renderPlanGlobal(); }
            if(id === 'quiz' && quizSession.count === 1) loadQuestion();
            if(id === 'recap') renderRecap();
        }

        function loadQuestion() {
            // 1. Priorit√© aux questions mal r√©pondues pr√©c√©demment
            let failedIds = Object.keys(globalErrors).map(Number).filter(id => !quizSession.currentSessionIds.includes(id));
            let available = QUIZ_DB.filter(q => !quizSession.currentSessionIds.includes(q.id));
            
            let qData;
            if(failedIds.length > 0 && Math.random() > 0.4) {
                // On pioche dans les erreurs √† 60% de probabilit√©
                let targetId = failedIds[Math.floor(Math.random() * failedIds.length)];
                qData = QUIZ_DB.find(q => q.id === targetId);
            } else {
                if(available.length === 0) {
                    alert("Toutes les questions du stock ont √©t√© r√©ussies !");
                    quizSession.currentSessionIds = []; // On repart √† z√©ro si tout est fini
                    available = QUIZ_DB;
                }
                qData = available[Math.floor(Math.random() * available.length)];
            }
            
            quizSession.currentSessionIds.push(qData.id);
            document.getElementById('quizCount').innerText = quizSession.count;
            document.getElementById('quizScore').innerText = quizSession.score;
            document.getElementById('questionText').innerText = qData.q;
            document.getElementById('feedbackArea').classList.add('hidden');
            document.getElementById('nextBtn').classList.add('hidden');
            
            const optionsArea = document.getElementById('optionsArea');
            optionsArea.innerHTML = "";
            qData.a.forEach((text, i) => {
                const btn = document.createElement('button');
                btn.className = "quiz-opt bg-white p-4 rounded-xl border-2 border-slate-200 hover:border-slate-800 font-bold transition text-left flex items-center gap-4 w-full cursor-pointer shadow-sm text-sm";
                btn.innerHTML = `<span class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-xs pointer-events-none">${String.fromCharCode(65+i)}</span> ${text}`;
                btn.onclick = () => checkAns(i === qData.c, btn, qData.r, qData.c, qData.id);
                optionsArea.appendChild(btn);
            });
        }

        function checkAns(isCorrect, clickedBtn, explanation, correctIdx, qId) {
            const btns = document.querySelectorAll('.quiz-opt');
            btns.forEach(b => b.disabled = true);
            const feedback = document.getElementById('feedbackArea');
            feedback.classList.remove('hidden');

            if(isCorrect) {
                quizSession.score += 10;
                quizSession.corrects++;
                // Si la question √©tait dans les erreurs, on la retire ou diminue son poids
                if(globalErrors[qId]) delete globalErrors[qId]; 
                feedback.className = "mt-8 p-4 rounded-xl border-2 border-green-500 bg-green-50 text-green-700 font-bold text-xs";
                feedback.innerHTML = `‚úÖ CORRECT ! <p class="text-[10px] font-normal mt-1">${explanation}</p>`;
                clickedBtn.classList.add('correct-flash');
            } else {
                quizSession.errors++;
                globalErrors[qId] = (globalErrors[qId] || 0) + 1;
                feedback.className = "mt-8 p-4 rounded-xl border-2 border-red-500 bg-red-50 text-red-700 font-bold text-xs";
                feedback.innerHTML = `‚ùå ERREUR. <p class="text-[10px] font-normal mt-1">${explanation}</p>`;
                clickedBtn.classList.add('bg-red-500', 'text-white', 'border-red-600');
                btns[correctIdx].classList.add('border-green-500', 'bg-green-50');
            }
            document.getElementById('nextBtn').classList.remove('hidden');
        }

        function nextQuestion() {
            quizSession.count++;
            if(quizSession.count > 30) {
                quizHistory.push({ date: new Date().toLocaleDateString(), score: quizSession.score, corrects: quizSession.corrects, errors: quizSession.errors });
                alert("Session termin√©e ! Score : " + quizSession.score + "/300");
                resetQuiz();
            } else { loadQuestion(); }
        }

        function resetQuiz() { 
            quizSession = { count: 1, score: 0, corrects: 0, errors: 0, currentSessionIds: [] }; 
            loadQuestion(); 
        }

        function renderRecap() {
            let chartH = ""; let tableH = "";
            quizHistory.slice(-10).forEach(session => {
                const hSucc = (session.corrects / 30) * 100;
                const hErr = (session.errors / 30) * 100;
                chartH += `<div class="bar-group"><div class="bar-success" style="height: ${hSucc}%"></div><div class="bar-error" style="height: ${hErr}%"></div></div>`;
                tableH += `<div class="flex justify-between text-[11px] border-b py-1"><span>${session.date}</span><span class="font-bold text-slate-600">${session.score} pts</span></div>`;
            });
            document.getElementById('scoreChart').innerHTML = chartH;
            document.getElementById('historyTable').innerHTML = tableH;

            const weakArea = document.getElementById('weaknessArea');
            const sortedErrors = Object.entries(globalErrors).sort((a,b) => b[1] - a[1]).slice(0, 3);
            if(sortedErrors.length > 0) {
                let h = "";
                sortedErrors.forEach(([id, count]) => {
                    const qObj = QUIZ_DB.find(q => q.id == id);
                    if(qObj) h += `<div class="p-3 bg-red-50 rounded-lg border-l-4 border-red-400"><p class="text-[10px] font-black text-red-800 uppercase">√âchou√©e ${count} fois</p><p class="text-xs font-bold text-slate-700">${qObj.q}</p></div>`;
                });
                weakArea.innerHTML = h;
            } else {
                weakArea.innerHTML = `<p class="text-xs text-slate-400 italic">Aucune erreur r√©currente. Bravo !</p>`;
            }
        }

        function renderPlanGlobal() {
            const keys = Object.keys(PDF_DATA);
            let h = `<h2 class="text-xl font-black mb-4 uppercase italic text-yellow-400">Progression globale</h2><div class="grid md:grid-cols-2 gap-8 text-sm">`;
            [ [0,7,"√âCRIT 1"], [7,10,"√âCRIT 2"] ].forEach(range => {
                h += `<div><p class="font-black text-white/50 border-b border-white/10 mb-2 uppercase text-[9px] tracking-widest">${range[2]}</p><ul class="space-y-2">`;
                keys.slice(range[0], range[1]).forEach(id => {
                    const pct = Math.min((timers[id] / 600) * 100, 100);
                    h += `<li class="flex items-center justify-between text-[11px]"><span>${PDF_DATA[id].title}</span><div class="mini-progress"><div class="mini-progress-bar" style="width: ${pct}%"></div></div></li>`;
                });
                h += `</ul></div>`;
            });
            document.getElementById('planGlobal').innerHTML = h + `</div>`;
        }

        function renderBiblio() {
            let h = "";
            Object.keys(PDF_DATA).forEach(id => {
                const d = PDF_DATA[id];
                h += `<div class="bg-white p-4 rounded-xl border-l-4 ${d.type==='E1'?'border-yellow-500':'border-blue-500'} shadow-sm flex flex-col justify-between" data-tags="${d.tags}">
                    <h3 class="font-bold text-xs mb-3">${d.title}</h3>
                    <button onclick="openModal('${id}')" class="text-[10px] bg-red-600 text-white py-2 rounded font-bold uppercase cursor-pointer">Consulter</button>
                </div>`;
            });
            document.getElementById('biblioList').innerHTML = h;
        }

        function openModal(id) {
            activeTimer = id; startTime = Date.now();
            const d = PDF_DATA[id];
            document.getElementById('modalBody').innerHTML = `
                <h2 class="text-xl font-black mb-2 text-red-700">${d.title}</h2>
                <a href="file:///C:/REVISIONS_CAPEPS/${d.file}" target="_blank" class="block bg-red-600 text-white text-center py-3 rounded-xl font-bold uppercase shadow-lg">Ouvrir le PDF</a>`;
            document.getElementById('contentModal').classList.add('active');
        }

        function closeModal() {
            if(activeTimer) { timers[activeTimer] += Math.floor((Date.now() - startTime) / 1000); updateTimersDisplay(); }
            document.getElementById('contentModal').classList.remove('active'); activeTimer = null;
        }

        function updateTimersDisplay() {
            const total = Object.values(timers).reduce((a, b) => a + b, 0);
            document.getElementById('mainProgressBar').style.width = Math.min((total/3600)*100, 100) + '%';
        }

        function exportData() {
            const data = { timers, history: quizHistory, globalErrors };
            const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
            a.download = `SAVES_CAPEPS.json`; a.click();
        }

        function importData(e) {
            const reader = new FileReader();
            reader.onload = (ev) => { 
                const d = JSON.parse(ev.target.result);
                timers = d.timers || {}; quizHistory = d.history || []; globalErrors = d.globalErrors || {};
                updateTimersDisplay(); renderPlanGlobal();
            };
            reader.readAsText(e.target.files[0]);
        }

        function searchContent() {
            let q = document.getElementById('searchBiblio').value.toLowerCase();
            document.querySelectorAll('#biblioList > div').forEach(c => {
                c.style.display = (c.getAttribute('data-tags').includes(q) || c.innerText.toLowerCase().includes(q)) ? 'flex' : 'none';
            });
        }

        function clearSearch() { document.getElementById('searchBiblio').value = ""; searchContent(); }

        window.onload = () => { renderPlanGlobal(); updateTimersDisplay(); };
    </script>
</body>
</html>